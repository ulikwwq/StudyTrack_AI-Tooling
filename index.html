<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StudyTrack</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="page-wrapper">
    <header>
      <h1>StudyTrack</h1>
      <button id="themeToggle">üåô</button>
    </header>

    <main>
      <div class="tasks-grid">
        <section class="task-form">
          <h2>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ</h2>
          <input id="subjectInput" type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞" />
          <input id="descInput" type="text" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è" />
          <button id="addTask">–î–æ–±–∞–≤–∏—Ç—å</button>
        </section>
        <section class="task-list">
          <h2>–ú–æ–∏ –∑–∞–¥–∞–Ω–∏—è</h2>
          <div class="stats">
            <span id="totalTasks">–í—Å–µ–≥–æ: 0</span>
            <span id="doneTasks">–í—ã–ø–æ–ª–Ω–µ–Ω–æ: 0</span>
            <span id="pendingTasks">–û—Å—Ç–∞–ª–æ—Å—å: 0</span>
          </div>
          <ul id="myTasks"></ul>
        </section>
      </div>
    </main>

    <footer>
      <p>¬© 2025 StudyTrack ‚Äî by <b>ulkwwq</b></p>
    </footer>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
  <script>
    const themeToggle = document.getElementById('themeToggle');
    const subjectInput = document.getElementById('subjectInput');
    const descInput = document.getElementById('descInput');
    const addTaskBtn = document.getElementById('addTask');
    const myTasks = document.getElementById('myTasks');
    const totalTasks = document.getElementById('totalTasks');
    const doneTasks = document.getElementById('doneTasks');
    const pendingTasks = document.getElementById('pendingTasks');

    let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
    let theme = localStorage.getItem('theme') || 'light';
    document.body.className = theme;

    themeToggle.textContent = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
    themeToggle.addEventListener('click', () => {
      theme = theme === 'light' ? 'dark' : 'light';
      document.body.className = theme;
      themeToggle.textContent = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
      localStorage.setItem('theme', theme);
    });

    addTaskBtn.addEventListener('click', () => {
      const subject = subjectInput.value.trim();
      const desc = descInput.value.trim();
      if (!subject || !desc) return alert('–ó–∞–ø–æ–ª–Ω–∏ –æ–±–∞ –ø–æ–ª—è!');
      const now = new Date().toLocaleString();
      tasks.push({ subject, desc, done: false, created: now, updated: null });
      saveTasks();
      subjectInput.value = '';
      descInput.value = '';
    });

    function saveTasks() {
      localStorage.setItem('tasks', JSON.stringify(tasks));
      renderTasks();
    }

    function renderTasks() {
      myTasks.innerHTML = '';
      tasks.forEach((t, index) => {
        const li = document.createElement('li');
        li.className = t.done ? 'done' : '';

        const infoDiv = document.createElement('div');
        infoDiv.className = 'info';
        const subjectEl = document.createElement('h3');
        subjectEl.textContent = t.subject;
        const descEl = document.createElement('p');
        descEl.textContent = t.desc;

        const dateEl = document.createElement('span');
        dateEl.className = 'date';
        dateEl.textContent = t.updated
          ? `–ò–∑–º–µ–Ω–µ–Ω–æ: ${t.updated}`
          : `–î–æ–±–∞–≤–ª–µ–Ω–æ: ${t.created}`;

        infoDiv.append(subjectEl, descEl, dateEl);

        const btnsDiv = document.createElement('div');
        btnsDiv.className = 'buttons';
        const doneBtn = document.createElement('button');
        doneBtn.textContent = t.done ? '‚ü≥' : '‚úîÔ∏è';
        const editBtn = document.createElement('button');
        editBtn.textContent = '‚úèÔ∏è';
        const delBtn = document.createElement('button');
        delBtn.textContent = 'üóëÔ∏è';

        doneBtn.addEventListener('click', () => {
          t.done = !t.done;
          saveTasks();
        });

        editBtn.addEventListener('click', () => {
          const newDesc = prompt('–ò–∑–º–µ–Ω–∏ –æ–ø–∏—Å–∞–Ω–∏–µ:', t.desc);
          if (newDesc !== null) {
            t.desc = newDesc;
            t.updated = new Date().toLocaleString();
            saveTasks();
          }
        });

        delBtn.addEventListener('click', () => {
          tasks.splice(index, 1);
          saveTasks();
        });

        btnsDiv.append(doneBtn, editBtn, delBtn);
        li.append(infoDiv, btnsDiv);
        myTasks.appendChild(li);
      });

      totalTasks.textContent = `–í—Å–µ–≥–æ: ${tasks.length}`;
      doneTasks.textContent = `–í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${tasks.filter(t => t.done).length}`;
      pendingTasks.textContent = `–û—Å—Ç–∞–ª–æ—Å—å: ${tasks.filter(t => !t.done).length}`;
    }

    // Drag & drop
    Sortable.create(myTasks, {
      animation: 150,
      onEnd(evt) {
        const moved = tasks.splice(evt.oldIndex, 1)[0];
        tasks.splice(evt.newIndex, 0, moved);
        saveTasks();
      }
    });

    renderTasks();
  </script>
</body>
</html>
