<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StudyTrack</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="page-wrapper">
    <header>
      <h1>StudyTrack</h1>
      <button id="themeToggle">üåô</button>
    </header>

    <main>
      <div class="tasks-grid">
        <!-- –§–æ—Ä–º–∞ -->
        <section class="task-form">
          <h2>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ</h2>
          <input id="subjectInput" type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞ *" />
          <input id="descInput" type="text" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" />
          <button id="addTask">–î–æ–±–∞–≤–∏—Ç—å</button>
        </section>

        <!-- –°–ø–∏—Å–æ–∫ -->
        <section class="task-list">
          <h2>–ú–æ–∏ –∑–∞–¥–∞–Ω–∏—è</h2>

          <div class="stats">
            <span id="totalTasks">–í—Å–µ–≥–æ: 0</span>
            <span id="doneTasks">–í—ã–ø–æ–ª–Ω–µ–Ω–æ: 0</span>
            <span id="pendingTasks">–û—Å—Ç–∞–ª–æ—Å—å: 0</span>
          </div>

          <button id="toggleSort" class="sort-btn">
            üîí –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤—ã–∫–ª—é—á–µ–Ω–æ
          </button>

          <ul id="myTasks"></ul>
        </section>
      </div>
    </main>

    <footer>
      <p>¬© 2025 StudyTrack ‚Äî by <b>ulkwwq</b></p>
    </footer>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

  <script>
    const themeToggle = document.getElementById('themeToggle');
    const subjectInput = document.getElementById('subjectInput');
    const descInput = document.getElementById('descInput');
    const addTaskBtn = document.getElementById('addTask');
    const myTasks = document.getElementById('myTasks');
    const totalTasks = document.getElementById('totalTasks');
    const doneTasks = document.getElementById('doneTasks');
    const pendingTasks = document.getElementById('pendingTasks');
    const toggleSortBtn = document.getElementById('toggleSort');

    let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
    let theme = localStorage.getItem('theme') || 'light';
    let sortable = null;
    let sortEnabled = false;

    document.body.className = theme;
    themeToggle.textContent = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';

    themeToggle.addEventListener('click', () => {
      theme = theme === 'light' ? 'dark' : 'light';
      document.body.className = theme;
      themeToggle.textContent = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
      localStorage.setItem('theme', theme);
    });

    addTaskBtn.addEventListener('click', () => {
      const subject = subjectInput.value.trim();
      const desc = descInput.value.trim();

      if (!subject) {
        alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞');
        return;
      }

      const now = new Date().toLocaleString();
      tasks.push({
        subject,
        desc: desc || '‚Äî',
        done: false,
        created: now,
        updated: null
      });

      saveTasks();
      subjectInput.value = '';
      descInput.value = '';
    });

    function saveTasks() {
      localStorage.setItem('tasks', JSON.stringify(tasks));
      renderTasks();
    }

    function renderTasks() {
      myTasks.innerHTML = '';

      tasks.forEach((t, index) => {
        const li = document.createElement('li');
        li.className = t.done ? 'done' : '';

        const info = document.createElement('div');
        info.className = 'info';

        const h3 = document.createElement('h3');
        h3.textContent = t.subject;

        const p = document.createElement('p');
        p.textContent = t.desc;

        const date = document.createElement('span');
        date.className = 'date';
        date.textContent = t.updated
          ? `–ò–∑–º–µ–Ω–µ–Ω–æ: ${t.updated}`
          : `–î–æ–±–∞–≤–ª–µ–Ω–æ: ${t.created}`;

        info.append(h3, p, date);

        const btns = document.createElement('div');
        btns.className = 'buttons';

        const doneBtn = document.createElement('button');
        doneBtn.textContent = t.done ? '‚ü≥' : '‚úîÔ∏è';

        const editBtn = document.createElement('button');
        editBtn.textContent = '‚úèÔ∏è';

        const delBtn = document.createElement('button');
        delBtn.textContent = 'üóëÔ∏è';

        doneBtn.onclick = () => {
          t.done = !t.done;
          saveTasks();
        };

        editBtn.onclick = () => {
          const newDesc = prompt('–ò–∑–º–µ–Ω–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ:', t.desc);
          if (newDesc !== null) {
            t.desc = newDesc || '‚Äî';
            t.updated = new Date().toLocaleString();
            saveTasks();
          }
        };

        delBtn.onclick = () => {
          tasks.splice(index, 1);
          saveTasks();
        };

        btns.append(doneBtn, editBtn, delBtn);
        li.append(info, btns);
        myTasks.appendChild(li);
      });

      totalTasks.textContent = `–í—Å–µ–≥–æ: ${tasks.length}`;
      doneTasks.textContent = `–í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${tasks.filter(t => t.done).length}`;
      pendingTasks.textContent = `–û—Å—Ç–∞–ª–æ—Å—å: ${tasks.filter(t => !t.done).length}`;
    }

    function enableSort() {
      sortable = Sortable.create(myTasks, {
        animation: 150,
        disabled: false,
        onEnd(evt) {
          const moved = tasks.splice(evt.oldIndex, 1)[0];
          tasks.splice(evt.newIndex, 0, moved);
          saveTasks();
        }
      });
    }

    function disableSort() {
      if (sortable) {
        sortable.destroy();
        sortable = null;
      }
    }

    toggleSortBtn.addEventListener('click', () => {
      sortEnabled = !sortEnabled;

      if (sortEnabled) {
        enableSort();
        toggleSortBtn.textContent = 'üîì –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ';
      } else {
        disableSort();
        toggleSortBtn.textContent = 'üîí –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤—ã–∫–ª—é—á–µ–Ω–æ';
      }
    });

    renderTasks();
  </script>
</body>
</html>
